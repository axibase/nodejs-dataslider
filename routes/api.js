'use strict';var express = require('express');var fs = require('fs');var Cacher = require('../helpers/cacher').Cacher;var logger = require('npmlog');var Series = require('atsd-api').Series;var fileHelper = require('../helpers/file-helper');var config = require('../config');module.exports = (function() {    var api = express.Router();    var cacher = new Cacher(config.cacheFolder);    var options = fileHelper.readApiOptions();    var series = new Series(options);    var cac    api.post('/series', function(req, res) {        var body = '';        req.on('data', function (chunk) {            body += chunk;        });        req.on('end', function () {            cacher.handleRequest(body, function (error, cached, cachePath) {                if (error) {                    logger.error('Error', 'err %', error);                    res.status(400).send('Bad Request');                } else {                    if (cached) {                        fs.readFile(cachePath, 'utf8', function (error, data) {                            if (error) {                                throw error;                            } else {                                res.send(data);                            }                        });                    } else {                        series.query(JSON.parse(body), function (error, response, data) {                            res.json(data);                            fs.writeFileSync(cachePath, JSON.stringify(data));                        });                    }                }            });        });    });    return api;})();